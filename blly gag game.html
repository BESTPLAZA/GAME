
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Adventure RPG</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Press Start 2P', cursive;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            overflow: hidden;
        }
        
        .game-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
        
        #gameCanvas {
            background: #000;
            display: block;
            margin: 0 auto;
            border: 4px solid #444;
        }
        
        .ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }
        
        .dialog-box {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            border: 3px solid #fff;
            padding: 20px;
            max-width: 80%;
            min-height: 100px;
            border-radius: 10px;
            animation: slideUp 0.3s ease-out;
            pointer-events: auto;
        }
        
        .dialog-text {
            font-size: 12px;
            line-height: 1.5;
            margin-bottom: 10px;
        }
        
        .dialog-continue {
            font-size: 10px;
            color: #ffff00;
            text-align: right;
            animation: blink 1s infinite;
        }
        
        .stats-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #fff;
            padding: 15px;
            font-size: 10px;
            border-radius: 5px;
        }
        
        .health-bar, .mp-bar {
            width: 100px;
            height: 8px;
            background: #333;
            border: 1px solid #fff;
            margin: 3px 0;
            position: relative;
        }
        
        .health-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4444, #ff6666);
            transition: width 0.3s ease;
        }
        
        .mp-fill {
            height: 100%;
            background: linear-gradient(90deg, #4444ff, #6666ff);
            transition: width 0.3s ease;
        }
        
        .controls-info {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #fff;
            padding: 10px;
            font-size: 8px;
            border-radius: 5px;
        }
        
        .battle-ui {
            position: absolute;
            bottom: 150px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            border: 3px solid #fff;
            padding: 20px;
            border-radius: 10px;
            display: none;
            pointer-events: auto;
        }
        
        .battle-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 10px;
        }
        
        .battle-option {
            padding: 10px;
            background: #333;
            border: 2px solid #666;
            color: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }
        
        .battle-option:hover,
        .battle-option.selected {
            background: #555;
            border-color: #fff;
            transform: scale(1.05);
        }
        
        .battle-option:disabled {
            background: #222;
            color: #666;
            cursor: not-allowed;
            transform: none;
        }
        
        @keyframes slideUp {
            from { transform: translate(-50%, 100%); }
            to { transform: translate(-50%, 0); }
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
            100% { transform: translateX(0); }
        }
        
        .shake {
            animation: shake 0.5s ease-in-out;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .title-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #1a1a2e, #16213e, #0f3460);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        .title {
            font-size: 24px;
            color: #ffff00;
            text-shadow: 2px 2px 0px #ff6600;
            margin-bottom: 30px;
            animation: glow 2s infinite alternate;
        }
        
        @keyframes glow {
            from { text-shadow: 2px 2px 0px #ff6600, 0 0 10px #ffff00; }
            to { text-shadow: 2px 2px 0px #ff6600, 0 0 20px #ffff00, 0 0 30px #ffff00; }
        }
        
        .start-button {
            font-family: 'Press Start 2P', cursive;
            font-size: 12px;
            padding: 15px 30px;
            background: #ff6600;
            color: white;
            border: 3px solid #fff;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .start-button:hover {
            background: #ff8800;
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <div class="game-container">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        
        <div class="title-screen" id="titleScreen">
            <div class="title">MYSTIC QUEST</div>
            <p style="font-size: 10px; margin-bottom: 20px; text-align: center;">
                A Pixel Adventure RPG<br>
                Save the Kingdom from Ancient Evil
            </p>
            <button class="start-button" onclick="startGame()">START ADVENTURE</button>
        </div>
        
        <div class="ui-overlay">
            <div class="stats-panel">
                <div>LEVEL: <span id="playerLevel">1</span></div>
                <div>HP: <span id="playerHp">100</span>/<span id="playerMaxHp">100</span></div>
                <div class="health-bar">
                    <div class="health-fill" id="healthFill" style="width: 100%;"></div>
                </div>
                <div>MP: <span id="playerMp">50</span>/<span id="playerMaxMp">50</span></div>
                <div class="mp-bar">
                    <div class="mp-fill" id="mpFill" style="width: 100%;"></div>
                </div>
                <div>EXP: <span id="playerExp">0</span></div>
                <div>GOLD: <span id="playerGold">100</span></div>
            </div>
            
            <div class="controls-info">
                <div>WASD - Move</div>
                <div>SPACE - Interact</div>
                <div>ENTER - Confirm</div>
                <div>ESC - Menu</div>
            </div>
            
            <div class="dialog-box" id="dialogBox" style="display: none;">
                <div class="dialog-text" id="dialogText"></div>
                <div class="dialog-continue">Press SPACE to continue...</div>
            </div>
            
            <div class="battle-ui" id="battleUI">
                <div style="text-align: center; margin-bottom: 15px; font-size: 12px;">
                    Choose your action:
                </div>
                <div class="battle-options">
                    <div class="battle-option" onclick="battleAction('attack')">‚öîÔ∏è ATTACK</div>
                    <div class="battle-option" onclick="battleAction('magic')">‚ú® MAGIC</div>
                    <div class="battle-option" onclick="battleAction('defend')">üõ°Ô∏è DEFEND</div>
                    <div class="battle-option" onclick="battleAction('item')">üß™ ITEM</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game state
        let gameState = {
            screen: 'title',
            player: {
                x: 400,
                y: 300,
                level: 1,
                hp: 100,
                maxHp: 100,
                mp: 50,
                maxMp: 50,
                exp: 0,
                gold: 100,
                direction: 'down',
                moving: false,
                animFrame: 0
            },
            currentQuest: 0,
            inBattle: false,
            enemy: null,
            dialogOpen: false,
            currentDialog: [],
            dialogIndex: 0,
            keys: {},
            sounds: {}
        };

        // Canvas setup
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        ctx.imageSmoothingEnabled = false;

        // Game maps and quests
        const quests = [
            {
                title: "The Awakening",
                description: "You wake up in the mystical forest. Find the Village Elder.",
                map: 'forest',
                objective: 'elder',
                dialog: [
                    "You awaken in a strange forest...",
                    "Your head throbs with forgotten memories.",
                    "A mysterious voice whispers: 'Find the Elder...'",
                    "Your adventure begins now!"
                ]
            },
            {
                title: "The Elder's Warning",
                description: "Dark creatures have appeared. Investigate the Ancient Ruins.",
                map: 'village',
                objective: 'ruins',
                dialog: [
                    "Elder: 'Young hero, darkness spreads across our land!'",
                    "Elder: 'Ancient seals are breaking...'",
                    "Elder: 'You must venture to the ruins and stop this evil!'",
                    "Quest accepted: Investigate the Ancient Ruins"
                ]
            },
            {
                title: "The Final Battle",
                description: "Face the Shadow Lord and save the kingdom!",
                map: 'ruins',
                objective: 'boss',
                dialog: [
                    "You enter the dark ruins...",
                    "Shadow Lord: 'Foolish mortal! You cannot stop me!'",
                    "The final battle begins!",
                    "Prepare yourself for the ultimate challenge!"
                ]
            }
        ];

        // Enemies data
        const enemies = {
            goblin: {
                name: 'Forest Goblin',
                hp: 40,
                maxHp: 40,
                attack: 15,
                defense: 5,
                exp: 25,
                gold: 20,
                sprite: 'üëπ'
            },
            skeleton: {
                name: 'Ancient Skeleton',
                hp: 60,
                maxHp: 60,
                attack: 20,
                defense: 8,
                exp: 40,
                gold: 35,
                sprite: 'üíÄ'
            },
            shadowlord: {
                name: 'Shadow Lord',
                hp: 150,
                maxHp: 150,
                attack: 35,
                defense: 15,
                exp: 200,
                gold: 500,
                sprite: 'üë§'
            }
        };

        // Audio context for sound effects
        let audioContext;
        
        function initAudio() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            } catch (e) {
                console.log('Audio not supported');
            }
        }

        function playSound(frequency, duration, type = 'sine') {
            if (!audioContext) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = frequency;
            oscillator.type = type;
            
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }

        function startGame() {
            document.getElementById('titleScreen').style.display = 'none';
            gameState.screen = 'game';
            initAudio();
            showDialog(quests[gameState.currentQuest].dialog);
            gameLoop();
        }

        function showDialog(dialog) {
            gameState.dialogOpen = true;
            gameState.currentDialog = dialog;
            gameState.dialogIndex = 0;
            
            const dialogBox = document.getElementById('dialogBox');
            const dialogText = document.getElementById('dialogText');
            
            dialogBox.style.display = 'block';
            dialogText.textContent = dialog[0];
            
            playSound(400, 0.1);
        }

        function nextDialog() {
            gameState.dialogIndex++;
            
            if (gameState.dialogIndex >= gameState.currentDialog.length) {
                closeDialog();
                return;
            }
            
            const dialogText = document.getElementById('dialogText');
            dialogText.textContent = gameState.currentDialog[gameState.dialogIndex];
            playSound(400, 0.1);
        }

        function closeDialog() {
            gameState.dialogOpen = false;
            document.getElementById('dialogBox').style.display = 'none';
            
            // Check if we should start a battle or advance quest
            if (gameState.currentQuest === 2) {
                startBattle(enemies.shadowlord);
            }
        }

        function startBattle(enemyData) {
            gameState.inBattle = true;
            gameState.enemy = { ...enemyData };
            document.getElementById('battleUI').style.display = 'block';
            
            playSound(200, 0.5, 'sawtooth');
            
            showDialog([`A wild ${enemyData.name} appears!`, "Prepare for battle!"]);
        }

        function battleAction(action) {
            if (!gameState.inBattle || gameState.dialogOpen) return;
            
            let damage = 0;
            let message = "";
            
            switch(action) {
                case 'attack':
                    damage = Math.max(1, 25 - gameState.enemy.defense + Math.random() * 10);
                    gameState.enemy.hp = Math.max(0, gameState.enemy.hp - damage);
                    message = `You deal ${Math.floor(damage)} damage!`;
                    playSound(800, 0.2, 'square');
                    break;
                    
                case 'magic':
                    if (gameState.player.mp >= 15) {
                        damage = Math.max(1, 35 - gameState.enemy.defense + Math.random() * 15);
                        gameState.enemy.hp = Math.max(0, gameState.enemy.hp - damage);
                        gameState.player.mp -= 15;
                        message = `Fireball deals ${Math.floor(damage)} damage!`;
                        playSound(1200, 0.3, 'triangle');
                        updateUI();
                    } else {
                        message = "Not enough MP!";
                        playSound(200, 0.3);
                    }
                    break;
                    
                case 'defend':
                    message = "You defend and recover 10 MP!";
                    gameState.player.mp = Math.min(gameState.player.maxMp, gameState.player.mp + 10);
                    playSound(600, 0.3);
                    updateUI();
                    break;
                    
                case 'item':
                    if (gameState.player.gold >= 50) {
                        const healing = 30;
                        gameState.player.hp = Math.min(gameState.player.maxHp, gameState.player.hp + healing);
                        gameState.player.gold -= 50;
                        message = `Used Potion! Recovered ${healing} HP!`;
                        playSound(1000, 0.2);
                        updateUI();
                    } else {
                        message = "No potions available!";
                        playSound(200, 0.3);
                    }
                    break;
            }
            
            if (gameState.enemy.hp <= 0) {
                // Victory
                gameState.player.exp += gameState.enemy.exp;
                gameState.player.gold += gameState.enemy.gold;
                
                const victoryDialog = [
                    `${gameState.enemy.name} defeated!`,
                    `Gained ${gameState.enemy.exp} EXP and ${gameState.enemy.gold} Gold!`
                ];
                
                // Level up check
                const expNeeded = gameState.player.level * 100;
                if (gameState.player.exp >= expNeeded) {
                    gameState.player.level++;
                    gameState.player.maxHp += 20;
                    gameState.player.hp = gameState.player.maxHp;
                    gameState.player.maxMp += 10;
                    gameState.player.mp = gameState.player.maxMp;
                    gameState.player.exp = 0;
                    
                    victoryDialog.push(`Level Up! Now Level ${gameState.player.level}!`);
                    playSound(1500, 1.0);
                }
                
                gameState.inBattle = false;
                document.getElementById('battleUI').style.display = 'none';
                
                showDialog(victoryDialog);
                
                // Advance quest
                gameState.currentQuest++;
                if (gameState.currentQuest >= quests.length) {
                    setTimeout(() => {
                        showDialog([
                            "Congratulations, Hero!",
                            "You have saved the kingdom!",
                            "The Shadow Lord is defeated!",
                            "Peace returns to the land...",
                            "THE END"
                        ]);
                    }, 2000);
                }
                
                updateUI();
                return;
            }
            
            // Enemy turn
            setTimeout(() => {
                const enemyDamage = Math.max(1, gameState.enemy.attack - 10 + Math.random() * 10);
                gameState.player.hp = Math.max(0, gameState.player.hp - enemyDamage);
                
                const battleDialog = [
                    message,
                    `${gameState.enemy.name} attacks for ${Math.floor(enemyDamage)} damage!`
                ];
                
                if (gameState.player.hp <= 0) {
                    battleDialog.push("You have been defeated...", "GAME OVER");
                    gameState.inBattle = false;
                    document.getElementById('battleUI').style.display = 'none';
                }
                
                showDialog(battleDialog);
                updateUI();
                
                // Screen shake on hit
                canvas.classList.add('shake');
                setTimeout(() => canvas.classList.remove('shake'), 500);
                
            }, 1000);
        }

        function updateUI() {
            document.getElementById('playerLevel').textContent = gameState.player.level;
            document.getElementById('playerHp').textContent = gameState.player.hp;
            document.getElementById('playerMaxHp').textContent = gameState.player.maxHp;
            document.getElementById('playerMp').textContent = gameState.player.mp;
            document.getElementById('playerMaxMp').textContent = gameState.player.maxMp;
            document.getElementById('playerExp').textContent = gameState.player.exp;
            document.getElementById('playerGold').textContent = gameState.player.gold;
            
            const healthPercent = (gameState.player.hp / gameState.player.maxHp) * 100;
            const mpPercent = (gameState.player.mp / gameState.player.maxMp) * 100;
            
            document.getElementById('healthFill').style.width = healthPercent + '%';
            document.getElementById('mpFill').style.width = mpPercent + '%';
        }

        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            gameState.keys[e.key.toLowerCase()] = true;
            
            if (!gameState.dialogOpen && !gameState.inBattle) {
                handleMovement(e.key.toLowerCase());
            }
            
            if (e.key === ' ' && gameState.dialogOpen) {
                e.preventDefault();
                nextDialog();
            }
            
            if (e.key === ' ' && !gameState.dialogOpen && !gameState.inBattle) {
                checkInteraction();
            }
        });

        document.addEventListener('keyup', (e) => {
            gameState.keys[e.key.toLowerCase()] = false;
            gameState.player.moving = false;
        });

        function handleMovement(key) {
            const speed = 4;
            let moved = false;
            
            switch(key) {
                case 'w':
                    gameState.player.y = Math.max(50, gameState.player.y - speed);
                    gameState.player.direction = 'up';
                    moved = true;
                    break;
                case 's':
                    gameState.player.y = Math.min(550, gameState.player.y + speed);
                    gameState.player.direction = 'down';
                    moved = true;
                    break;
                case 'a':
                    gameState.player.x = Math.max(50, gameState.player.x - speed);
                    gameState.player.direction = 'left';
                    moved = true;
                    break;
                case 'd':
                    gameState.player.x = Math.min(750, gameState.player.x + speed);
                    gameState.player.direction = 'right';
                    moved = true;
                    break;
            }
            
            if (moved) {
                gameState.player.moving = true;
                gameState.player.animFrame = (gameState.player.animFrame + 1) % 4;
                
                // Random encounter chance
                if (Math.random() < 0.01 && gameState.currentQuest < 2) {
                    const randomEnemy = gameState.currentQuest === 0 ? enemies.goblin : enemies.skeleton;
                    startBattle(randomEnemy);
                }
            }
        }

        function checkInteraction() {
            // Check for quest objectives
            if (gameState.currentQuest === 0 && 
                Math.abs(gameState.player.x - 400) < 50 && 
                Math.abs(gameState.player.y - 200) < 50) {
                
                gameState.currentQuest = 1;
                showDialog(quests[1].dialog);
            }
            else if (gameState.currentQuest === 1 && 
                     Math.abs(gameState.player.x - 600) < 50 && 
                     Math.abs(gameState.player.y - 400) < 50) {
                
                gameState.currentQuest = 2;
                showDialog(quests[2].dialog);
            }
        }

        function drawGame() {
            // Clear canvas
            ctx.fillStyle = '#0a0a0a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw background based on current quest
            if (gameState.currentQuest === 0) {
                // Forest
                ctx.fillStyle = '#1a4a1a';
                for (let i = 0; i < 20; i++) {
                    const x = (i * 50) % canvas.width;
                    const y = Math.floor(i / 16) * 50;
                    ctx.fillRect(x, y, 40, 40);
                }
                
                // Elder location
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(375, 175, 50, 50);
                ctx.fillStyle = '#FFD700';
                ctx.font = '20px Arial';
                ctx.fillText('üßô‚Äç‚ôÇÔ∏è', 385, 205);
            }
            else if (gameState.currentQuest === 1) {
                // Village
                ctx.fillStyle = '#8B4513';
                for (let i = 0; i < 10; i++) {
                    const x = 100 + (i % 3) * 150;
                    const y = 200 + Math.floor(i / 3) * 100;
                    ctx.fillRect(x, y, 80, 60);
                }
                
                // Ruins entrance
                ctx.fillStyle = '#555';
                ctx.fillRect(575, 375, 50, 50);
                ctx.fillStyle = '#FF0000';
                ctx.font = '20px Arial';
                ctx.fillText('üèõÔ∏è', 585, 405);
            }
            else {
                // Ruins
                ctx.fillStyle = '#333';
                for (let i = 0; i < 30; i++) {
                    const x = Math.random() * canvas.width;
                    const y = Math.random() * canvas.height;
                    ctx.fillRect(x, y, 20, 20);
                }
                
                // Boss area
                ctx.fillStyle = '#800080';
                ctx.fillRect(350, 250, 100, 100);
            }
            
            // Draw player
            ctx.save();
            ctx.translate(gameState.player.x, gameState.player.y);
            
            // Player sprite animation
            const bobOffset = gameState.player.moving ? Math.sin(gameState.player.animFrame * 0.5) * 2 : 0;
            ctx.translate(0, bobOffset);
            
            ctx.fillStyle = '#4169E1';
            ctx.fillRect(-15, -15, 30, 30);
            
            // Player face
            ctx.fillStyle = '#FFE4B5';
            ctx.fillRect(-12, -12, 24, 20);
            
            // Eyes
            ctx.fillStyle = '#000';
            ctx.fillRect(-8, -8, 3, 3);
            ctx.fillRect(5, -8, 3, 3);
            
            // Direction indicator
            ctx.fillStyle = '#FF0000';
            switch(gameState.player.direction) {
                case 'up':
                    ctx.fillRect(-2, -18, 4, 4);
                    break;
                case 'down':
                    ctx.fillRect(-2, 12, 4, 4);
                    break;
                case 'left':
                    ctx.fillRect(-18, -2, 4, 4);
                    break;
                case 'right':
                    ctx.fillRect(14, -2, 4, 4);
                    break;
            }
            
            ctx.restore();
            
            // Draw enemy in battle
            if (gameState.inBattle && gameState.enemy) {
                ctx.save();
                ctx.translate(400, 150);
                
                // Enemy sprite
                ctx.font = '40px Arial';
                ctx.fillText(gameState.enemy.sprite, -20, 20);
                
                // Enemy health bar
                ctx.fillStyle = '#000';
                ctx.fillRect(-50, -60, 100, 10);
                
                const enemyHealthPercent = gameState.enemy.hp / gameState.enemy.maxHp;
                ctx.fillStyle = enemyHealthPercent > 0.5 ? '#0F0' : enemyHealthPercent > 0.25 ? '#FF0' : '#F00';
                ctx.fillRect(-50, -60, 100 * enemyHealthPercent, 10);
                
                // Enemy name
                ctx.fillStyle = '#FFF';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(gameState.enemy.name, 0, -70);
                
                ctx.restore();
            }
            
            // Draw quest indicator
            if (!gameState.inBattle) {
                ctx.fillStyle = '#FFD700';
                ctx.font = '16px Arial';
                ctx.textAlign = 'left';
                
                const currentQuestData = quests[gameState.currentQuest];
                if (currentQuestData) {
                    ctx.fillText(`Quest: ${currentQuestData.title}`, 20, canvas.height - 20);
                }
            }
        }

        function gameLoop() {
            if (gameState.screen !== 'game') return;
            
            drawGame();
            requestAnimationFrame(gameLoop);
        }

        // Initialize UI
        updateUI();
    </script>
</body>
</html>